<UserControl x:Class="renkimsumatin.Views.ScoresView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:renkimsumatin.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    mc:Ignorable="d"
    d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <converters:ScoreToGradeConverter x:Key="ScoreToGradeConverter"/>
        <converters:NullToNAConverter x:Key="NullToNAConverter"/>
        <!-- Smaller refresh button style (top-right, orange) -->
        <Style x:Key="RefreshButtonStyle" TargetType="Button">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="MinWidth" Value="60"/>
            <Setter Property="Margin" Value="6,0,0,0"/>
            <Setter Property="Background" Value="#F59E0B"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <DockPanel Margin="10">
            <TextBlock Text="Scores Management" FontSize="20" FontWeight="Bold" DockPanel.Dock="Left"/>
            <Button Content="Refresh" Command="{Binding RefreshCommand}" DockPanel.Dock="Right"
                    Style="{StaticResource RefreshButtonStyle}" VerticalAlignment="Top" HorizontalAlignment="Right"/>
        </DockPanel>

        <!-- Add / Update Score Form -->
        <Border Grid.Row="1" Background="White" CornerRadius="5" Margin="10" Padding="10">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <StackPanel x:Name="StudentPanel" Margin="0,0,10,0" Width="220">
                    <TextBlock Text="Student"/>
                    <ComboBox ItemsSource="{Binding Students}" SelectedValuePath="Id" DisplayMemberPath="Name"
                              SelectedValue="{Binding SelectedStudentId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel x:Name="SubjectPanel" Margin="0,0,10,0" Width="220">
                    <TextBlock Text="Subject"/>
                    <ComboBox ItemsSource="{Binding Subjects}" SelectedValuePath="Id" DisplayMemberPath="Name"
                              SelectedValue="{Binding SelectedSubjectId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel x:Name="AssessmentPanel" Margin="0,0,10,0" Width="220">
                    <TextBlock Text="Assessment"/>
                    <ComboBox ItemsSource="{Binding Assessments}" SelectedValuePath="Id" DisplayMemberPath="Name"
                              SelectedValue="{Binding SelectedAssessmentId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel x:Name="ScorePanel" Margin="0,0,10,0" Width="120">
                    <TextBlock Text="Score"/>
                    <TextBox Text="{Binding MarksObtained, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PreviewTextInput="NumberValidationTextBox"/>
                </StackPanel>
                <Button Content="Save" Command="{Binding AddOrUpdateScoreCommand}" Background="#4F46E5" Foreground="White" Padding="10,5"/>
            </StackPanel>
        </Border>

        <!-- Scores Table -->
        <Border Grid.Row="2" Background="White" CornerRadius="5" Margin="10" Padding="10">
            <ListView ItemsSource="{Binding Scores}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Student Name" DisplayMemberBinding="{Binding StudentName}" Width="150"/>
                        <GridViewColumn Header="Assessment" DisplayMemberBinding="{Binding AssessmentName}" Width="150"/>
                        <GridViewColumn Header="Score" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding MarksObtained, Converter={StaticResource NullToNAConverter}}"
                                               HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Total Marks" DisplayMemberBinding="{Binding TotalMarks}" Width="100"/>
                        <GridViewColumn Header="Grade" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource ScoreToGradeConverter}">
                                                <Binding Path="MarksObtained"/>
                                                <Binding Path="TotalMarks"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Actions" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Delete" Command="{Binding DataContext.DeleteScoreCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}" Background="#EF4444" Foreground="White" Padding="5,2"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Border>
    </Grid>
</UserControl>